{"ast":null,"code":"var _jsxFileName = \"/Volumes/T7 Touch/PHP/API2022/reactapi2022/src/pages/InvoicesPage.jsx\",\n    _s = $RefreshSig$();\n\nimport { useState, useEffect } from 'react';\nimport Pagination from '../components/Pagination';\nimport invoicesAPI from '../services/invoicesAPI';\nimport moment from 'moment';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst STATUS_CLASSES = {\n  PAID: \"success\",\n  SENT: \"primary\",\n  CANCELLED: \"danger\"\n};\nconst STATUS_LABELS = {\n  PAID: \"Payée\",\n  SENT: \"Envoyée\",\n  CANCELLED: \"Annulée\"\n};\n\nconst InvoicesPage = props => {\n  _s();\n\n  const [invoices, setInvoices] = useState([]);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [search, setSearch] = useState(\"\");\n  const itemsPerPage = 10; // récup les invoices \n\n  const fetchInvoice = async () => {\n    try {\n      const data = await invoicesAPI.findAll();\n      setInvoices(data);\n    } catch (error) {\n      console.log(error.response); // notif à faire\n    }\n  };\n\n  useEffect(() => {\n    fetchInvoice();\n  }, []); // gestion du changement de page\n\n  const handlePageChange = page => {\n    setCurrentPage(page);\n  }; // gestion de la recherche\n\n\n  const handleSearch = event => {\n    const value = event.currentTarget.value;\n    setSearch(value);\n    setCurrentPage(1);\n  }; // gestion de la suppression \n\n\n  const handleDelete = async id => {\n    const originalInvoices = [...invoices];\n    setInvoices(invoices.filter(invoice => invoice.id !== id));\n\n    try {\n      await invoicesAPI.delete(id);\n    } catch (error) {\n      // notif à faire\n      setInvoices(originalInvoices);\n    }\n  };\n\n  const filteredInvoices = invoices.filter(i => i.customer.lastName.toLowerCase().includes(search.toLowerCase()) || i.customer.firstName.toLowerCase().includes(search.toLowerCase()) || i.amount.toString().includes(search.toLowerCase()) || STATUS_LABELS[i.status].toLowerCase().includes(search.toLowerCase()));\n  const paginatedInvoices = Pagination.getData(filteredInvoices, currentPage, itemsPerPage);\n\n  const formatDate = str => moment(str).format('DD/MM/YYYY');\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"Liste des factures\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"form-group\",\n      children: /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        className: \"form-control\",\n        placeholder: \"Rechercher...\",\n        onChange: handleSearch,\n        value: search\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 10\n    }, this), /*#__PURE__*/_jsxDEV(\"table\", {\n      className: \"table table-hover\",\n      children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n        children: /*#__PURE__*/_jsxDEV(\"tr\", {\n          children: [/*#__PURE__*/_jsxDEV(\"th\", {\n            className: \"text-center\",\n            children: \"Num\\xE9ro\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 89,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n            className: \"text-center\",\n            children: \"Client\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 90,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n            className: \"text-center\",\n            children: \"Date d'envoi\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 91,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n            className: \"text-center\",\n            children: \"Statut\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 92,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n            className: \"text-center\",\n            children: \"Montant\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 93,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n            className: \"text-center\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 94,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 88,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n        children: paginatedInvoices.map(invoice => /*#__PURE__*/_jsxDEV(\"tr\", {\n          children: [/*#__PURE__*/_jsxDEV(\"td\", {\n            className: \"text-center\",\n            children: invoice.id\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 101,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n            className: \"text-center\",\n            children: [invoice.customer.firstName, \" \", invoice.customer.lastName]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 102,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n            className: \"text-center\",\n            children: formatDate(invoice.sentAt)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 103,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n            className: \"text-center\",\n            children: /*#__PURE__*/_jsxDEV(\"span\", {\n              className: `badge bg-${STATUS_CLASSES[invoice.status]}`,\n              children: STATUS_LABELS[invoice.status]\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 105,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 104,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n            className: \"text-center\",\n            children: [invoice.amount.toLocaleString(), \"\\u20AC\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 109,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n            className: \"text-center\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"btn btn-sm btn-success mx-3\",\n              children: \"Editer\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 111,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => handleDelete(invoice.id),\n              className: \"btn btn-sm btn-danger\",\n              children: \"Supprimer\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 112,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 110,\n            columnNumber: 29\n          }, this)]\n        }, invoice.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 25\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 9\n    }, this), itemsPerPage < filteredInvoices.length && /*#__PURE__*/_jsxDEV(Pagination, {\n      currentPage: currentPage,\n      itemsPerPage: itemsPerPage,\n      length: filteredInvoices.length,\n      onPageChanged: handlePageChange\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true);\n};\n\n_s(InvoicesPage, \"q17fZIAp42gP2GP3JhfID7AJ1uU=\");\n\n_c = InvoicesPage;\nexport default InvoicesPage;\n\nvar _c;\n\n$RefreshReg$(_c, \"InvoicesPage\");","map":{"version":3,"sources":["/Volumes/T7 Touch/PHP/API2022/reactapi2022/src/pages/InvoicesPage.jsx"],"names":["useState","useEffect","Pagination","invoicesAPI","moment","STATUS_CLASSES","PAID","SENT","CANCELLED","STATUS_LABELS","InvoicesPage","props","invoices","setInvoices","currentPage","setCurrentPage","search","setSearch","itemsPerPage","fetchInvoice","data","findAll","error","console","log","response","handlePageChange","page","handleSearch","event","value","currentTarget","handleDelete","id","originalInvoices","filter","invoice","delete","filteredInvoices","i","customer","lastName","toLowerCase","includes","firstName","amount","toString","status","paginatedInvoices","getData","formatDate","str","format","map","sentAt","toLocaleString","length"],"mappings":"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","sourcesContent":["import {useState, useEffect} from 'react';\nimport Pagination from '../components/Pagination';\nimport invoicesAPI from '../services/invoicesAPI';\nimport moment from 'moment';\n\nconst STATUS_CLASSES = {\n    PAID: \"success\",\n    SENT: \"primary\",\n    CANCELLED: \"danger\"\n}\n\nconst STATUS_LABELS = {\n    PAID: \"Payée\",\n    SENT: \"Envoyée\",\n    CANCELLED: \"Annulée\"\n}\n\n\nconst InvoicesPage = (props) => {\n\n    const [invoices, setInvoices] = useState([])\n    const [currentPage, setCurrentPage] = useState(1)\n    const [search, setSearch] = useState(\"\")\n    const itemsPerPage = 10 \n\n    // récup les invoices \n    const fetchInvoice = async () => {\n        try{\n            const data = await invoicesAPI.findAll()\n            setInvoices(data)\n        }catch(error){\n            console.log(error.response)\n            // notif à faire\n        }\n    }\n\n    useEffect(()=> {\n        fetchInvoice()\n    },[])\n\n    // gestion du changement de page\n    const handlePageChange = (page) => {\n        setCurrentPage(page)\n    }\n\n    // gestion de la recherche\n    const handleSearch = event => {\n        const value = event.currentTarget.value \n        setSearch(value)\n        setCurrentPage(1)\n    }\n\n    // gestion de la suppression \n    const handleDelete = async (id) => {\n        const originalInvoices = [...invoices] \n        setInvoices(invoices.filter(invoice => invoice.id !== id))\n\n        try{\n            await invoicesAPI.delete(id)\n        }catch(error)\n        {\n            // notif à faire\n            setInvoices(originalInvoices)\n        }\n    }\n\n    const filteredInvoices = invoices.filter(i => \n        i.customer.lastName.toLowerCase().includes(search.toLowerCase()) ||    \n        i.customer.firstName.toLowerCase().includes(search.toLowerCase()) ||\n        i.amount.toString().includes(search.toLowerCase()) || \n        STATUS_LABELS[i.status].toLowerCase().includes(search.toLowerCase())\n    )\n\n\n    const paginatedInvoices = Pagination.getData(filteredInvoices, currentPage, itemsPerPage)\n\n    const formatDate = (str) => moment(str).format('DD/MM/YYYY')\n\n    return ( \n    <>\n        <h1>Liste des factures</h1>\n         {/* filtre */}\n         <div className=\"form-group\">\n                <input type=\"text\" className='form-control' placeholder='Rechercher...' onChange={handleSearch} value={search} />\n        </div>\n        <table className=\"table table-hover\">\n            <thead>\n                <tr>\n                    <th className='text-center'>Numéro</th>\n                    <th className='text-center'>Client</th>\n                    <th className='text-center'>Date d'envoi</th>\n                    <th className='text-center'>Statut</th>\n                    <th className='text-center'>Montant</th>\n                    <th className='text-center'></th>\n                </tr>\n            </thead>\n            <tbody>\n                {\n                    paginatedInvoices.map(invoice => (\n                        <tr key={invoice.id}>\n                            <td className=\"text-center\">{invoice.id}</td>\n                            <td className=\"text-center\">{invoice.customer.firstName} {invoice.customer.lastName}</td>\n                            <td className=\"text-center\">{formatDate(invoice.sentAt)}</td>\n                            <td className=\"text-center\">\n                                <span className={`badge bg-${STATUS_CLASSES[invoice.status]}`}>\n                                    {STATUS_LABELS[invoice.status]}\n                                </span>\n                            </td>\n                            <td className=\"text-center\">{invoice.amount.toLocaleString()}€</td>\n                            <td className=\"text-center\">\n                                <button className=\"btn btn-sm btn-success mx-3\">Editer</button>\n                                <button\n                                    onClick={()=> handleDelete(invoice.id)} \n                                    className=\"btn btn-sm btn-danger\">Supprimer</button>\n                            </td>\n                        </tr>\n                    ))\n                }\n            </tbody>\n        </table>\n    \n            {/*pagination*/}\n            {\n                itemsPerPage < filteredInvoices.length && \n                <Pagination \n                    currentPage={currentPage}\n                    itemsPerPage={itemsPerPage}\n                    length={filteredInvoices.length}\n                    onPageChanged={handlePageChange}\n                />\n            }\n       \n    </>\n     );\n}\n \nexport default InvoicesPage;"]},"metadata":{},"sourceType":"module"}